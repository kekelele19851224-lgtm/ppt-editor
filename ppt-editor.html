<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AI生成PPT</title>
  <script src="./docmee-ui-sdk-iframe.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; }
    #ppt-container { width: 100%; height: 100%; }
    .loading { display: flex; align-items: center; justify-content: center; height: 100%; font-size: 16px; color: #666; }
    .error { color: #e74c3c; padding: 20px; text-align: center; }
  </style>
</head>
<body>
  <div id="ppt-container">
    <div class="loading">加载中...</div>
  </div>

  <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
  <script>
    function getParams(){var p={},s=location.search.slice(1).split('&');for(var i=0;i<s.length;i++){if(!s[i])continue;var t=s[i].split('=');p[decodeURIComponent(t[0])]=decodeURIComponent(t[1]||'')}return p}
    var params=getParams();
    var token=params.token||'';
    var pptId=params.pptId||'';
    var mode=params.mode||'create';
    function init(){
      if(typeof DocmeeUI==='undefined'){document.getElementById('ppt-container').innerHTML='<div class="error">SDK 加载失败，请刷新重试</div>';return}
      if(!token){document.getElementById('ppt-container').innerHTML='<div class="error">缺少 token 参数</div>';return}
      document.getElementById('ppt-container').innerHTML='';
      var config={
        token: token,
        container: document.querySelector('#ppt-container'),
        lang:'zh',mode:'light',isMobile:true,background:'#f5f5f5',padding:'0',
        creatorVersion:'v2',
        onMessage:function(message){
          console.log('DocmeeUI 事件:', message.type, message);
          if(message.type==='invalid-token'){alert('登录已过期，请返回重试');if(window.wx&&wx.miniProgram){wx.miniProgram.navigateBack();}}
          if(message.type==='error'){console.error('错误:',message.data);if(message.data&&message.data.code===88){alert('生成次数已用完')}}
          if(message.type==='afterGenerate'){console.log('PPT 生成完成，ID:', message.data&&message.data.id)}
        }
      };
      if(mode==='edit'&&pptId){config.page='editor';config.pptId=pptId}else{config.page='creator'}
      try{var docmeeUI=new DocmeeUI(config);window.docmeeUI=docmeeUI}catch(err){console.error('初始化失败:',err);document.getElementById('ppt-container').innerHTML='<div class="error">初始化失败: '+err.message+'</div>'}
    }
    init();
  </script>
</body>
</html>
